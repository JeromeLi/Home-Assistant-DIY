# add-on的对外通讯

## add-on的程序环境



## 访问外部网络

在add-on中，可以自由访问外部的网络

## 访问其它docker容器

- supervisor架构下，所有docker容器的网络为`172.30.32.0/23`

    + 172.30.32.1   homeassistant core以及所有设置`host_network`为`true`的add-on
    + 172.30.32.2   supervisor
    + 172.30.32.3   dns
    + 172.30.33.x   各种add-on

- 各docker容器直接可以通过内部网络相互访问
- 一般通过docker容器的主机名访问

## 访问HomeAssistant Core API

*注：你也可以通过docker容器间通讯访问HomeAssistant Core API，但这种方式需要自己配置与管理“长期访问另外”。*

- config文件配置

    `homeassistant_api: true`

- 环境变量`SUPERVISOR_TOKEN`

- [REST API](https://developers.home-assistant.io/docs/api/rest)

    `http://supervisor/core/api/*`

    `curl -X GET -H "Authorization: Bearer ${SUPERVISOR_TOKEN}" -H "Content-Type: application/json" http://supervisor/core/api/discovery_info`

- [WebSocket API](https://developers.home-assistant.io/docs/api/websocket)

    `http://supervisor/core/websocket`

## 访问[Supervisor API](https://developers.home-assistant.io/docs/api/supervisor/endpoints)

- config文件配置

    `hassio_api: true`

- 环境变量`SUPERVISOR_TOKEN`

- Supervisor API

    `http://supervisor/core/api/*`

    `curl -sSL -H "Authorization: Bearer $SUPERVISOR_TOKEN" http://supervisor/network/info`
